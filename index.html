<!doctype html>
<html lang="en">

<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Login</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
 
        $.ajax({
            url: "http://localhost/fullstack/jquery/project/app/controllers/loginFromSession.php", async: false,
            success: function (data) {
                
                if (data.status > 0) {
                   
                    location.href = "web/";
                }
            },
            error: function (error) {
                console.log("error : ", error);
            }
           
        }); 

    </script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="web/css/custom.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
        crossorigin="anonymous">
    <style>
        body{
            background-color:rgba(255, 255, 255, 0.027);
        }
        body::after{
            content: "";
            background: url(web/images/login.jpg);
            background-repeat: no-repeat;
            background-size: 100% 100%;
           
            opacity: 0.1;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            position: absolute;
            z-index: -1;      
        }
        
       
        .bg-light
        {
            background-color: #dddddd !important;

        }
    </style>

</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-md navbar-dark bg-nav fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand p-0" href="index.html"><img class="logo m-0 p-0" src="web/images/logo.png" width="100"
                    height="43"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

        </div>
    </nav>
    <main class="wrapper">

        <div class="container ">

            <form class="form-horizontal" name="loginFrm" id="loginFrm" role="form" method="POST" action="http://localhost/fullstack/jquery/project/app/controllers/login.php">
                <div class="row">
                    <div class="col-md-3"></div>
                    <div class="col-md-6 text-center">

                        <div class="bg-dark text-white  text-center p-2 mb-2 shadow-sm" style="border-radius: 25px 25px  2px 2px;">

                            <h5>Login To Academic Admin <i class="fas fa-user-circle"></i> </h5>
                        </div>
                        <div class="error mb-1 " role="alert " style="background-color: #fadcd7; color: red">
                            <div id="emailpassword">
                            </div>
                        </div>


                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3"></div>
                    <div class="col-md-6">
                        <div class="form-group has-danger bg-light p-2 rounded">
                            <label class="sr-only" for="email">E-Mail Address</label>
                            <div class="input-group  mr-sm-2 mb-sm-0">
                                <div class="input-group-addon pt-2 pl-2" style="width: 2.6rem"><i class="fa fa-at text-info"></i></div>
                                <input type="text" name="email" class="form-control" id="email" placeholder="Enrer email"
                                    required autofocus>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-3"></div>
                    <div class="col-md-6 ">
                        <div class="form-group has-danger  bg-light  rounded p-2">
                            <label class="sr-only" for="password">Password</label>
                            <div class="input-group mr-sm-2 mb-sm-0">
                                <div class="input-group-addon pt-2 pl-2" style="width: 2.6rem"><i class="fa fa-key text-info"></i></div>
                                <input type="password" name="password" class="form-control" id="password" placeholder="Enter password"
                                    required>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- <div class="row">
                    <div class="col-md-3"></div>
                    <div class="col-md-6" style="padding-top: .35rem">
                        <div class="form-check mb-2 mr-sm-2 mb-sm-0">
                            <label class="form-check-label">
                                <input class="form-check-input" name="remember"
                                       type="checkbox" >
                                <span style="padding-bottom: .15rem">Remember me</span>
                            </label>
                        </div>
                    </div>
                </div> -->
                <div class="row">
                    <div class="col-md-3"></div>
                    <div class="col-md-6 ">
                        <button type="submit" class=" btn btn-info btn-block" style="border-radius: 2px 2px 25px 25px;"><i
                                class="fa fa-sign-in"></i> Login</button>
                        <!-- <a class="btn btn-link" href="/password/reset">Forgot Your Password?</a> -->
                    </div>
                </div>
            </form>
        </div>
    </main>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
        <script type="text/javascript" src="js/slick.min.js"></script>
    <script>
        $(function () {

            // var url = 'http://localhost/fullstack/jquery/project/app/controllers/login.php';
            //     $.ajax({ 
            //         type: 'POST', 
            //         datatype: 'json',
            //         url: url, 
            //         // success:function (data) { 
            //         //     if(data>0) $(location).attr('href',"app/controllers/home.php");
            //         // },
            //         // error:function(error){
            //         //     console.log("error : " ,error);
            //         // }
            //     });

            var $inputElement;
            var textError;
            // Initialize form validation on the registration form.
            // It has the name attribute "registration"
            $("form[name='loginFrm']").validate({

                errorClass: "text-danger",
                // Specify validation rules
                rules: {
                    email: {
                        required: true,
                        // Specify that email should be validated
                        // by the built-in "email" rule
                        email: true
                    },
                    password: {
                        required: true,
                        minlength: 4
                    }
                },
                // Specify validation error messages
                messages: {

                    password: {
                        required: "<i class='fas fa-times m-3'>   Please provide a password</i>",
                        minlength: "<i class='fas fa-times m-3'>   Your password must be at least 4 characters long</i>"
                    },
                    email: {
                        required: "<i class='fas fa-times m-3'>  Please provide a email</i>",
                        email: "<i class='fas fa-times m-3'>   Your email address must be in the format of name@domain.com</i>"
                    }
                },
                submitHandler: function (form) {

                    //prevent default action 
                    var post_url = $(form).attr("action"); //get form action url

                    var request_method = $(form).attr("method"); //get form GET/POST method
                    var form_data = $(form).serialize(); //Encode form elements for submission

                    $.ajax({
                        url: post_url,
                        type: request_method,
                        datatype: 'json',
                        data: form_data
                    })
                        .done(function (response) { //
                            console.log("db response:", response);
                            $.each(response, function (key, value) {

                                if (key == 'user') $(location).attr('href', "web/");
                                if (key == 'errors') showErrorLogin(value);
                            });

                            // if(response>0){
                            //     $(location).attr('href',"web/html");
                            // }
                        })
                        .fail(function (request, status, error) {
                            console.log("request " + request);
                            console.log("status " + status);
                            console.log("error " + error);
                        });
                    return false;


                }
                // Make sure the form is submitted to the destination defined
                // in the "action" attribute of the form when valid
            });


        });

        function showErrorLogin(arr) {

            $.each(arr, function (key, value) {
                $inputElement = $('#' + value[1]);
                console.log($inputElement);
                textError = value[0];
                $inputElement.addClass('text-danger');
                $('.form-control-feedback').remove();
                $inputElement.parent().append(" <div class='form-control-feedback'><span class='text-danger align-middle'><i class='fas fa-times m-3'> " + textError + "</i></span></div>");
                $inputElement.focus(function () {
                    $('.form-control-feedback').remove();
                    $inputElement.removeClass('text-danger');
                });
            })

        }

    </script>
</body>

</html>